<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gallery - ST. LAWRENCE JUNIOR SCHOOL - KABOWA</title>
    <meta name="description" content="Explore our school gallery showcasing events, facilities, students, and activities at St. Lawrence Junior School Kabowa.">
    
    <!-- Favicon -->
    <link href="../img/favicon.ico" rel="icon">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- AOS Animation -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../css/redesign-style.css?v=3.0">
    
    <!-- Mobile Improvements CSS -->
    <link rel="stylesheet" href="../css/mobile-improvements.css">
    
    <!-- Page Loader CSS -->
    <link rel="stylesheet" href="../css/page-loader.css">
</head>
<body>
    
    <!-- Page Loader - Orbit -->
    <div class="page-loader" id="pageLoader">
        <div class="loader-logo">
            <img src="../img/5.jpg" alt="St. Lawrence Logo">
        </div>
        <div class="loader-text">ST. LAWRENCE</div>
        <div class="loader-subtitle">Junior School - Kabowa</div>
        <div class="loader-orbit">
            <div class="orbit-dot"></div>
            <div class="orbit-dot"></div>
            <div class="orbit-dot"></div>
        </div>
    </div>
    
    <!-- Header / Navigation -->
    <header class="header" id="header">
        <div class="container">
            <nav class="navbar">
                <!-- Logo Section -->
                <div class="logo">
                    <div class="logo-badge">
                        <img src="../img/5.jpg" alt="St. Lawrence Logo" class="logo-img">
                    </div>
                    <div class="logo-text-container">
                        <span class="logo-text">ST.LAWRENCE</span>
                        <span class="logo-subtitle">Junior School - Kabowa</span>
                    </div>
                </div>
                
                <!-- Navigation Menu -->
                <ul class="nav-menu" id="navMenu">
                    <!-- Desktop Menu Items -->
                    <li class="desktop-only"><a href="index-redesign.html" class="nav-link">Home</a></li>
                    <li class="desktop-only nav-dropdown">
                        <a href="About-redesign.html" class="nav-link">About <i class="fas fa-chevron-down"></i></a>
                        <ul class="dropdown-menu">
                            <li><a href="About-redesign.html">Our Story</a></li>
                            <li><a href="School-Anthem.html">School Anthem</a></li>
                            <li><a href="Academics.html">Academics</a></li>
                        </ul>
                    </li>
                    <li class="desktop-only"><a href="Teachers-redesign.html" class="nav-link">Teachers</a></li>
                    <li class="desktop-only"><a href="Gallery-redesign.html" class="nav-link active">Gallery</a></li>
                    <li class="desktop-only nav-dropdown">
                        <a href="Admission-redesign.html" class="nav-link">Admission <i class="fas fa-chevron-down"></i></a>
                        <ul class="dropdown-menu">
                            <li><a href="Admission-redesign.html">Apply Now</a></li>
                            <li><a href="Fees.html">Fees</a></li>
                        </ul>
                    </li>
                    <li class="desktop-only"><a href="Contact-redesign.html" class="nav-link">Contact</a></li>
                    <li class="desktop-only"><a href="Library-redesign.html" class="nav-link">Library</a></li>
                    
                    <!-- Mobile Menu Items -->
                    <li class="mobile-only"><a href="index-redesign.html" class="nav-link-mobile">Home</a></li>
                    <li class="mobile-only mobile-expandable">
                        <div class="nav-link-mobile">
                            <span>About Us</span>
                            <span class="mobile-expand-icon">+</span>
                        </div>
                        <ul class="mobile-submenu">
                            <li><a href="About-redesign.html">Our Story</a></li>
                            <li><a href="School-Anthem.html">School Anthem</a></li>
                            <li><a href="Academics.html">Academics</a></li>
                        </ul>
                    </li>
                    <li class="mobile-only"><a href="Teachers-redesign.html" class="nav-link-mobile">Teachers</a></li>
                    <li class="mobile-only"><a href="Gallery-redesign.html" class="nav-link-mobile">Gallery</a></li>
                    <li class="mobile-only mobile-expandable">
                        <div class="nav-link-mobile">
                            <span>Admissions</span>
                            <span class="mobile-expand-icon">+</span>
                        </div>
                        <ul class="mobile-submenu">
                            <li><a href="Admission-redesign.html">Apply Now</a></li>
                            <li><a href="Fees.html">Fees</a></li>
                        </ul>
                    </li>
                    <li class="mobile-only"><a href="Contact-redesign.html" class="nav-link-mobile">Contact</a></li>
                    <li class="mobile-only"><a href="Library.html" class="nav-link-mobile">Library</a></li>
                </ul>
                
                <!-- Admin Button -->
                <div class="nav-actions">
                    <a href="../backend/admin/login.html" class="btn-admin">
                        <i class="fas fa-shield-alt"></i>
                        <span>Admin</span>
                    </a>
                </div>
                
                <!-- Mobile Hamburger -->
                <button class="hamburger" id="hamburger" aria-label="Toggle menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </nav>
        </div>
    </header>

    <!-- Page Hero -->
    <section class="page-hero">
        <div class="page-hero-bg">
            <img src="https://images.unsplash.com/photo-1523050854058-8df90110c9f1?w=1600&q=80" alt="Gallery">
            <div class="page-hero-overlay"></div>
        </div>
        <div class="page-hero-content">
            <div class="breadcrumb" data-aos="fade-down">
                <a href="index-redesign.html">Home</a>
                <span>/</span>
                <span>Gallery</span>
            </div>
            <h1 data-aos="fade-up">Our Gallery</h1>
            <p data-aos="fade-up" data-aos-delay="100">Capturing Moments of Excellence and Joy</p>
        </div>
    </section>

    <!-- Gallery Section -->
    <section class="teachers-departments-section">
        <div class="container">
            <div class="section-header" data-aos="fade-up">
                <span class="section-tag">Our Memories</span>
                <h2 class="section-title">School Gallery</h2>
                <p class="section-description">Filter by category to explore our school life</p>
            </div>
            
            <!-- Category Filter Buttons -->
            <div class="department-filters" data-aos="fade-up" data-aos-delay="100">
                <button class="dept-filter-btn active" data-category="all">
                    <i class="fas fa-th"></i>
                    <span>ALL</span>
                </button>
                <button class="dept-filter-btn" data-category="events">
                    <i class="fas fa-calendar-alt"></i>
                    <span>EVENTS</span>
                </button>
                <button class="dept-filter-btn" data-category="facilities">
                    <i class="fas fa-building"></i>
                    <span>FACILITIES</span>
                </button>
                <button class="dept-filter-btn" data-category="students">
                    <i class="fas fa-users"></i>
                    <span>STUDENTS</span>
                </button>
                <button class="dept-filter-btn" data-category="activities">
                    <i class="fas fa-running"></i>
                    <span>ACTIVITIES</span>
                </button>
                <button class="dept-filter-btn" data-category="achievements">
                    <i class="fas fa-trophy"></i>
                    <span>ACHIEVEMENTS</span>
                </button>
            </div>
            
            <!-- Gallery Grid -->
            <div class="gallery-grid" id="galleryContainer" data-aos="fade-up" data-aos-delay="200">
                <!-- Gallery images will be loaded dynamically from database -->
                <div style="grid-column: 1/-1; text-align: center; padding: 60px 20px; color: #666;">
                    <div class="spinner" style="margin: 0 auto 20px;"></div>
                    <p style="font-size: 1.1rem;">Loading gallery images...</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <!-- Video Background -->
        <video class="footer-video" autoplay muted loop playsinline>
            <source src="../img/students walking.mp4" type="video/mp4">
        </video>
        <div class="footer-overlay"></div>
        
        <div class="container">
            <div class="footer-grid">
                <!-- Column 1 - Brand -->
                <div class="footer-col footer-brand-col">
                    <div class="footer-logo">
                        <img src="../img/5.jpg" alt="St. Lawrence Logo">
                        <span>ST. LAWRENCE</span>
                    </div>
                    <p class="footer-description">Excellence in Education since 2010. Nurturing young minds for a brighter future.</p>
                    <div class="social-links">
                        <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                        <a href="#" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
                
                <!-- Column 2 - Quick Links -->
                <div class="footer-col">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="index-redesign.html">Home</a></li>
                        <li><a href="About-redesign.html">About Us</a></li>
                        <li><a href="Teachers-redesign.html">Teachers</a></li>
                        <li><a href="Gallery-redesign.html">Gallery</a></li>
                        <li><a href="Admission-redesign.html">Admission</a></li>
                    </ul>
                </div>
                
                <!-- Column 3 - Programs -->
                <div class="footer-col">
                    <h3>Programs</h3>
                    <ul>
                        <li><a href="Academics.html">Nursery School</a></li>
                        <li><a href="Academics.html">Primary School</a></li>
                        <li><a href="Admission-redesign.html">Boarding</a></li>
                        <li><a href="Admission-redesign.html">Day School</a></li>
                        <li><a href="Library-redesign.html">Library</a></li>
                    </ul>
                </div>
                
                <!-- Column 4 - Contact Us -->
                <div class="footer-col">
                    <h3>Contact Us</h3>
                    <ul class="contact-info">
                        <li>
                            <i class="fas fa-map-marker-alt"></i>
                            <a href="https://maps.google.com/?q=St.+Lawrence+Junior+School+Kabowa" target="_blank">P.O.BOX 36198, KAMPALA</a>
                        </li>
                        <li>
                            <i class="fas fa-phone"></i>
                            <a href="tel:+256701420506">+256 701 420 506</a> / <a href="tel:+256772420506">+256 772 420 506</a>
                        </li>
                        <li>
                            <i class="fas fa-envelope"></i>
                            <a href="mailto:stlawrencejuniorschoolkabowa@gmail.com">stlawrencejuniorschoolkabowa@gmail.com</a>
                        </li>
                        <li>
                            <i class="fas fa-envelope"></i>
                            <a href="mailto:st.lawrence.juniorschool@yahoo.com">st.lawrence.juniorschool@yahoo.com</a>
                        </li>
                    </ul>
                </div>
            </div>
            
            <!-- Footer Bottom - Copyright -->
            <div class="footer-copyright">
                <div class="container">
                    <div class="copyright-content">
                        <p>&copy; 2024 St. Lawrence Junior School - Kabowa. All rights reserved.</p>
                        <p class="footer-credit">Designed with <i class="fas fa-heart"></i> for Excellence in Education</p>
                    </div>
                </div>
            </div>

            <!-- Developer Info Section -->
            <div class="footer-developer">
                <div class="container">
                    <div class="developer-info">
                        <p class="developer-label">Developed by</p>
                        <h4 class="developer-name">MUWANGA IBRAHIM SEKIMPI</h4>
                        <div class="developer-contact">
                            <a href="tel:0708486440" class="developer-link">
                                <i class="fas fa-phone"></i>
                                <span>0708 486 440</span>
                            </a>
                            <span class="separator">|</span>
                            <a href="mailto:cultoonmovic4@gmail.com" class="developer-link">
                                <i class="fas fa-envelope"></i>
                                <span>cultoonmovic4@gmail.com</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Back to Top Button -->
    <button class="back-to-top" id="backToTop" aria-label="Back to top">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- Advanced Lightbox Modal -->
    <div class="lightbox-modal" id="lightboxModal">
        <!-- Lightbox Background Overlay -->
        <div class="lightbox-backdrop"></div>
        
        <!-- Lightbox Header -->
        <div class="lightbox-header">
            <div class="lightbox-header-left">
                <div class="lightbox-counter" id="lightboxCounter">
                    <span class="counter-current">1</span>
                    <span class="counter-separator">/</span>
                    <span class="counter-total">15</span>
                </div>
                <div class="lightbox-category" id="lightboxCategory">
                    <i class="fas fa-tag"></i>
                    <span>Events</span>
                </div>
            </div>
            
            <div class="lightbox-header-right">
                <button class="lightbox-action-btn" id="lightboxSlideshow" title="Slideshow">
                    <i class="fas fa-play"></i>
                </button>
                <button class="lightbox-action-btn" id="lightboxZoomIn" title="Zoom In">
                    <i class="fas fa-search-plus"></i>
                </button>
                <button class="lightbox-action-btn" id="lightboxZoomOut" title="Zoom Out">
                    <i class="fas fa-search-minus"></i>
                </button>
                <button class="lightbox-action-btn" id="lightboxRotate" title="Rotate">
                    <i class="fas fa-redo"></i>
                </button>
                <button class="lightbox-action-btn" id="lightboxDownload" title="Download">
                    <i class="fas fa-download"></i>
                </button>
                <button class="lightbox-action-btn" id="lightboxShare" title="Share">
                    <i class="fas fa-share-alt"></i>
                </button>
                <button class="lightbox-action-btn" id="lightboxFullscreen" title="Fullscreen">
                    <i class="fas fa-expand"></i>
                </button>
                <button class="lightbox-close" id="lightboxClose" title="Close (Esc)">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        
        <!-- Navigation Arrows -->
        <button class="lightbox-nav lightbox-prev" id="lightboxPrev" title="Previous (←)">
            <i class="fas fa-chevron-left"></i>
        </button>
        
        <button class="lightbox-nav lightbox-next" id="lightboxNext" title="Next (→)">
            <i class="fas fa-chevron-right"></i>
        </button>
        
        <!-- Main Content Area -->
        <div class="lightbox-content">
            <!-- Image Container with Zoom/Pan Support -->
            <div class="lightbox-image-wrapper" id="lightboxImageWrapper">
                <div class="lightbox-image-container" id="lightboxImageContainer">
                    <img src="" alt="" id="lightboxImage" draggable="false">
                </div>
                
                <!-- Loading Spinner -->
                <div class="lightbox-loader" id="lightboxLoader">
                    <div class="loader-spinner"></div>
                    <p>Loading image...</p>
                </div>
            </div>
            

        </div>
        
        <!-- Thumbnail Strip -->
        <div class="lightbox-thumbnails-wrapper">
            <button class="thumbnail-scroll-btn thumbnail-scroll-left" id="thumbnailScrollLeft">
                <i class="fas fa-chevron-left"></i>
            </button>
            <div class="lightbox-thumbnails" id="lightboxThumbnails">
                <!-- Thumbnails will be dynamically inserted here -->
            </div>
            <button class="thumbnail-scroll-btn thumbnail-scroll-right" id="thumbnailScrollRight">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
        
        <!-- Zoom Indicator -->
        <div class="lightbox-zoom-indicator" id="lightboxZoomIndicator">
            <i class="fas fa-search-plus"></i>
            <span id="zoomPercentage">100%</span>
        </div>
        
        <!-- Share Menu (Hidden by default) -->
        <div class="lightbox-share-menu" id="lightboxShareMenu">
            <button class="share-option" data-platform="facebook">
                <i class="fab fa-facebook-f"></i>
                <span>Facebook</span>
            </button>
            <button class="share-option" data-platform="twitter">
                <i class="fab fa-twitter"></i>
                <span>Twitter</span>
            </button>
            <button class="share-option" data-platform="pinterest">
                <i class="fab fa-pinterest"></i>
                <span>Pinterest</span>
            </button>
            <button class="share-option" data-platform="whatsapp">
                <i class="fab fa-whatsapp"></i>
                <span>WhatsApp</span>
            </button>
            <button class="share-option" data-platform="copy">
                <i class="fas fa-link"></i>
                <span>Copy Link</span>
            </button>
        </div>
    </div>

    <!-- AOS Animation -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    
    <!-- Custom JavaScript -->
    <script src="../js/redesign-script.js"></script>
    
    <!-- API Integration -->
    <script src="../js/api-config.js?v=6"></script>
    <script src="../js/api-gallery.js?v=6"></script>
    
    <script>
        // Initialize AOS
        AOS.init({
            duration: 1000,
            once: true,
            offset: 100
        });
        
        // Mobile Menu Functionality
        const hamburger = document.getElementById('hamburger');
        const navMenu = document.getElementById('navMenu');
        const mobileExpandables = document.querySelectorAll('.mobile-expandable');
        
        if (hamburger && navMenu) {
            hamburger.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                const isActive = navMenu.classList.contains('active');
                
                if (isActive) {
                    hamburger.classList.remove('active');
                    navMenu.classList.remove('active');
                    document.body.style.overflow = '';
                } else {
                    hamburger.classList.add('active');
                    navMenu.classList.add('active');
                    document.body.style.overflow = 'hidden';
                }
            });
        }
        
        mobileExpandables.forEach(item => {
            const link = item.querySelector('.nav-link-mobile');
            
            if (link) {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    mobileExpandables.forEach(otherItem => {
                        if (otherItem !== item && otherItem.classList.contains('active')) {
                            otherItem.classList.remove('active');
                        }
                    });
                    
                    item.classList.toggle('active');
                });
            }
        });
        
        const submenuLinks = document.querySelectorAll('.mobile-submenu a');
        submenuLinks.forEach(link => {
            link.addEventListener('click', function() {
                if (hamburger && navMenu) {
                    hamburger.classList.remove('active');
                    navMenu.classList.remove('active');
                    document.body.style.overflow = '';
                }
            });
        });
        
        const regularMobileLinks = document.querySelectorAll('.mobile-only:not(.mobile-expandable) .nav-link-mobile');
        regularMobileLinks.forEach(link => {
            link.addEventListener('click', function() {
                if (hamburger && navMenu) {
                    hamburger.classList.remove('active');
                    navMenu.classList.remove('active');
                    document.body.style.overflow = '';
                }
            });
        });
        
        // Gallery Filter Functionality
        const filterButtons = document.querySelectorAll('.dept-filter-btn');
        const galleryItems = document.querySelectorAll('.gallery-item');
        
        filterButtons.forEach(button => {
            button.addEventListener('click', function() {
                const category = this.getAttribute('data-category');
                
                // Update active button
                filterButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                
                // Filter gallery items with smooth animation
                galleryItems.forEach(item => {
                    const itemCategory = item.getAttribute('data-category');
                    
                    if (category === 'all' || itemCategory === category) {
                        // Show item
                        item.classList.remove('hidden');
                        item.classList.add('visible');
                    } else {
                        // Hide item
                        item.classList.remove('visible');
                        item.classList.add('hidden');
                    }
                });
                
                // Scroll to gallery grid smoothly
                const galleryGrid = document.querySelector('.gallery-grid');
                if (galleryGrid) {
                    setTimeout(() => {
                        galleryGrid.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    }, 100);
                }
            });
        });
        
        // Initialize all items as visible
        galleryItems.forEach(item => {
            item.classList.add('visible');
        });
        
        // Advanced Lightbox Functionality
        const lightboxModal = document.getElementById('lightboxModal');
        const lightboxImage = document.getElementById('lightboxImage');
        const lightboxImageContainer = document.getElementById('lightboxImageContainer');
        const lightboxImageWrapper = document.getElementById('lightboxImageWrapper');
        const lightboxClose = document.getElementById('lightboxClose');
        const lightboxPrev = document.getElementById('lightboxPrev');
        const lightboxNext = document.getElementById('lightboxNext');
        const lightboxThumbnails = document.getElementById('lightboxThumbnails');
        const lightboxCounter = document.getElementById('lightboxCounter');
        const lightboxCategory = document.getElementById('lightboxCategory');
        const lightboxLoader = document.getElementById('lightboxLoader');
        const lightboxShareMenu = document.getElementById('lightboxShareMenu');
        
        // Action buttons
        const btnZoomIn = document.getElementById('lightboxZoomIn');
        const btnZoomOut = document.getElementById('lightboxZoomOut');
        const btnRotate = document.getElementById('lightboxRotate');
        const btnDownload = document.getElementById('lightboxDownload');
        const btnShare = document.getElementById('lightboxShare');
        const btnSlideshow = document.getElementById('lightboxSlideshow');
        const btnFullscreen = document.getElementById('lightboxFullscreen');
        const thumbnailScrollLeft = document.getElementById('thumbnailScrollLeft');
        const thumbnailScrollRight = document.getElementById('thumbnailScrollRight');
        const zoomIndicator = document.getElementById('lightboxZoomIndicator');
        const zoomPercentage = document.getElementById('zoomPercentage');
        
        let currentImageIndex = 0;
        let visibleItems = [];
        let zoomLevel = 1;
        let rotation = 0;
        let isDragging = false;
        let startX, startY, translateX = 0, translateY = 0;
        let slideshowInterval = null;
        let isFullscreen = false;
        
        // Open lightbox when clicking gallery items
        galleryItems.forEach((item, index) => {
            const viewBtn = item.querySelector('.gallery-view-btn');
            
            const openHandler = function(e) {
                e.stopPropagation();
                visibleItems = Array.from(galleryItems).filter(item => 
                    item.classList.contains('visible') && !item.classList.contains('hidden')
                );
                currentImageIndex = visibleItems.indexOf(item);
                openLightbox(item);
            };
            
            item.addEventListener('click', openHandler);
            if (viewBtn) {
                viewBtn.addEventListener('click', openHandler);
            }
        });
        
        function openLightbox(item) {
            const img = item.querySelector('img');
            const title = item.querySelector('.gallery-overlay h3').textContent;
            const description = item.querySelector('.gallery-overlay p').textContent;
            const category = item.getAttribute('data-category');
            
            // Reset transformations
            zoomLevel = 1;
            rotation = 0;
            translateX = 0;
            translateY = 0;
            updateImageTransform();
            
            // Show loader
            lightboxLoader.style.display = 'flex';
            lightboxImage.style.opacity = '0';
            
            // Load image
            const tempImg = new Image();
            tempImg.onload = function() {
                lightboxImage.src = img.src;
                lightboxImage.alt = title;
                
                // Hide loader and show image
                setTimeout(() => {
                    lightboxLoader.style.display = 'none';
                    lightboxImage.style.opacity = '1';
                }, 300);
            };
            tempImg.src = img.src;
            
            // Update counter
            updateCounter();
            
            // Update category badge
            lightboxCategory.querySelector('span').textContent = category.charAt(0).toUpperCase() + category.slice(1);
            
            // Generate thumbnails
            generateThumbnails();
            
            // Show modal
            lightboxModal.classList.add('active');
            document.body.style.overflow = 'hidden';
            
            // Update zoom indicator
            updateZoomIndicator();
        }
        
        function closeLightbox() {
            lightboxModal.classList.remove('active');
            document.body.style.overflow = '';
            lightboxShareMenu.classList.remove('active');
            stopSlideshow();
            
            if (isFullscreen && document.fullscreenElement) {
                document.exitFullscreen();
            }
        }
        
        function showPrevImage() {
            currentImageIndex = (currentImageIndex - 1 + visibleItems.length) % visibleItems.length;
            openLightbox(visibleItems[currentImageIndex]);
        }
        
        function showNextImage() {
            currentImageIndex = (currentImageIndex + 1) % visibleItems.length;
            openLightbox(visibleItems[currentImageIndex]);
        }
        
        function updateCounter() {
            const current = lightboxCounter.querySelector('.counter-current');
            const total = lightboxCounter.querySelector('.counter-total');
            current.textContent = currentImageIndex + 1;
            total.textContent = visibleItems.length;
        }
        
        function generateThumbnails() {
            lightboxThumbnails.innerHTML = '';
            
            visibleItems.forEach((item, index) => {
                const img = item.querySelector('img');
                const thumb = document.createElement('div');
                thumb.className = 'lightbox-thumbnail';
                if (index === currentImageIndex) {
                    thumb.classList.add('active');
                }
                
                const thumbImg = document.createElement('img');
                thumbImg.src = img.src;
                thumbImg.alt = item.querySelector('.gallery-overlay h3').textContent;
                
                thumb.appendChild(thumbImg);
                thumb.addEventListener('click', () => {
                    currentImageIndex = index;
                    openLightbox(visibleItems[currentImageIndex]);
                });
                
                lightboxThumbnails.appendChild(thumb);
            });
        }
        
        // Zoom functionality
        function zoomIn() {
            if (zoomLevel < 3) {
                zoomLevel += 0.25;
                updateImageTransform();
                updateZoomIndicator();
            }
        }
        
        function zoomOut() {
            if (zoomLevel > 0.5) {
                zoomLevel -= 0.25;
                updateImageTransform();
                updateZoomIndicator();
                
                // Reset position if zoomed out completely
                if (zoomLevel === 1) {
                    translateX = 0;
                    translateY = 0;
                }
            }
        }
        
        function resetZoom() {
            zoomLevel = 1;
            translateX = 0;
            translateY = 0;
            updateImageTransform();
            updateZoomIndicator();
        }
        
        function rotateImage() {
            rotation = (rotation + 90) % 360;
            updateImageTransform();
        }
        
        function updateImageTransform() {
            lightboxImage.style.transform = `translate(${translateX}px, ${translateY}px) scale(${zoomLevel}) rotate(${rotation}deg)`;
        }
        
        function updateZoomIndicator() {
            zoomPercentage.textContent = Math.round(zoomLevel * 100) + '%';
            
            if (zoomLevel !== 1) {
                zoomIndicator.classList.add('active');
                setTimeout(() => {
                    zoomIndicator.classList.remove('active');
                }, 1500);
            }
        }
        
        // Pan/Drag functionality
        lightboxImageContainer.addEventListener('mousedown', startDrag);
        lightboxImageContainer.addEventListener('touchstart', startDrag);
        
        function startDrag(e) {
            if (zoomLevel <= 1) return;
            
            isDragging = true;
            lightboxImageContainer.style.cursor = 'grabbing';
            
            const clientX = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX;
            const clientY = e.type === 'touchstart' ? e.touches[0].clientY : e.clientY;
            
            startX = clientX - translateX;
            startY = clientY - translateY;
            
            e.preventDefault();
        }
        
        document.addEventListener('mousemove', drag);
        document.addEventListener('touchmove', drag);
        
        function drag(e) {
            if (!isDragging) return;
            
            const clientX = e.type === 'touchmove' ? e.touches[0].clientX : e.clientX;
            const clientY = e.type === 'touchmove' ? e.touches[0].clientY : e.clientY;
            
            translateX = clientX - startX;
            translateY = clientY - startY;
            
            updateImageTransform();
        }
        
        document.addEventListener('mouseup', stopDrag);
        document.addEventListener('touchend', stopDrag);
        
        function stopDrag() {
            isDragging = false;
            lightboxImageContainer.style.cursor = zoomLevel > 1 ? 'grab' : 'default';
        }
        
        // Mouse wheel zoom
        lightboxImageWrapper.addEventListener('wheel', (e) => {
            e.preventDefault();
            
            if (e.deltaY < 0) {
                zoomIn();
            } else {
                zoomOut();
            }
        });
        
        // Double click to zoom
        lightboxImage.addEventListener('dblclick', () => {
            if (zoomLevel === 1) {
                zoomLevel = 2;
            } else {
                zoomLevel = 1;
                translateX = 0;
                translateY = 0;
            }
            updateImageTransform();
            updateZoomIndicator();
        });
        
        // Download functionality
        function downloadImage() {
            const link = document.createElement('a');
            link.href = lightboxImage.src;
            link.download = 'gallery-image.jpg';
            link.click();
        }
        
        // Share functionality
        function toggleShareMenu() {
            lightboxShareMenu.classList.toggle('active');
        }
        
        document.querySelectorAll('.share-option').forEach(btn => {
            btn.addEventListener('click', function() {
                const platform = this.getAttribute('data-platform');
                const url = window.location.href;
                const imageUrl = lightboxImage.src;
                
                let shareUrl = '';
                
                switch(platform) {
                    case 'facebook':
                        shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`;
                        break;
                    case 'twitter':
                        shareUrl = `https://twitter.com/intent/tweet?url=${encodeURIComponent(url)}`;
                        break;
                    case 'pinterest':
                        shareUrl = `https://pinterest.com/pin/create/button/?url=${encodeURIComponent(url)}&media=${encodeURIComponent(imageUrl)}`;
                        break;
                    case 'whatsapp':
                        shareUrl = `https://wa.me/?text=${encodeURIComponent(url)}`;
                        break;
                    case 'copy':
                        navigator.clipboard.writeText(url).then(() => {
                            alert('Link copied to clipboard!');
                        });
                        lightboxShareMenu.classList.remove('active');
                        return;
                }
                
                if (shareUrl) {
                    window.open(shareUrl, '_blank', 'width=600,height=400');
                    lightboxShareMenu.classList.remove('active');
                }
            });
        });
        
        // Slideshow functionality
        function toggleSlideshow() {
            if (slideshowInterval) {
                stopSlideshow();
            } else {
                startSlideshow();
            }
        }
        
        function startSlideshow() {
            btnSlideshow.innerHTML = '<i class="fas fa-pause"></i>';
            btnSlideshow.classList.add('active');
            slideshowInterval = setInterval(() => {
                showNextImage();
            }, 3000);
        }
        
        function stopSlideshow() {
            if (slideshowInterval) {
                clearInterval(slideshowInterval);
                slideshowInterval = null;
                btnSlideshow.innerHTML = '<i class="fas fa-play"></i>';
                btnSlideshow.classList.remove('active');
            }
        }
        
        // Fullscreen functionality
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                lightboxModal.requestFullscreen().then(() => {
                    isFullscreen = true;
                    btnFullscreen.innerHTML = '<i class="fas fa-compress"></i>';
                }).catch(err => {
                    console.log('Fullscreen error:', err);
                });
            } else {
                document.exitFullscreen().then(() => {
                    isFullscreen = false;
                    btnFullscreen.innerHTML = '<i class="fas fa-expand"></i>';
                });
            }
        }
        
        // Thumbnail scrolling
        thumbnailScrollLeft.addEventListener('click', () => {
            lightboxThumbnails.scrollBy({ left: -200, behavior: 'smooth' });
        });
        
        thumbnailScrollRight.addEventListener('click', () => {
            lightboxThumbnails.scrollBy({ left: 200, behavior: 'smooth' });
        });
        
        // Event listeners
        lightboxClose.addEventListener('click', closeLightbox);
        lightboxPrev.addEventListener('click', showPrevImage);
        lightboxNext.addEventListener('click', showNextImage);
        btnZoomIn.addEventListener('click', zoomIn);
        btnZoomOut.addEventListener('click', zoomOut);
        btnRotate.addEventListener('click', rotateImage);
        btnDownload.addEventListener('click', downloadImage);
        btnShare.addEventListener('click', toggleShareMenu);
        btnSlideshow.addEventListener('click', toggleSlideshow);
        btnFullscreen.addEventListener('click', toggleFullscreen);
        
        // Close on background click
        lightboxModal.addEventListener('click', function(e) {
            if (e.target === lightboxModal || e.target.classList.contains('lightbox-backdrop')) {
                closeLightbox();
            }
        });
        
        // Close share menu when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('#lightboxShare') && !e.target.closest('#lightboxShareMenu')) {
                lightboxShareMenu.classList.remove('active');
            }
        });
        
        // Keyboard navigation
        document.addEventListener('keydown', function(e) {
            if (!lightboxModal.classList.contains('active')) return;
            
            switch(e.key) {
                case 'Escape':
                    closeLightbox();
                    break;
                case 'ArrowLeft':
                    showPrevImage();
                    break;
                case 'ArrowRight':
                    showNextImage();
                    break;
                case '+':
                case '=':
                    zoomIn();
                    break;
                case '-':
                case '_':
                    zoomOut();
                    break;
                case '0':
                    resetZoom();
                    break;
                case 'r':
                case 'R':
                    rotateImage();
                    break;
                case 'f':
                case 'F':
                    toggleFullscreen();
                    break;
                case ' ':
                    e.preventDefault();
                    toggleSlideshow();
                    break;
            }
        });
    </script>
    
    <!-- Page Loader Script -->
    <script src="../js/page-loader.js"></script>
</body>
</html>
